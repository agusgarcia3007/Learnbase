import { Hono } from "hono";
import { getS3Object, type Env } from "./s3";

const app = new Hono<{ Bindings: Env }>();

const FAVICON_BASE64 =
  "AAABAAMAMDAAAAEAIACoJQAANgAAACAgAAABACAAqBAAAN4lAAAQEAAAAQAgAGgEAACGNgAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAQAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzlUAFc5VBOjNVAT/zVQE/81VBeHMUgoZAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAANFVCCHOVQXZzVQE/81UBP/NVAXay1IIIgAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAADPUAAQzFUF3s1UBP/NVAT/zlUF6s5VDBUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzlUAFc5VBOjNVAT/zVQE/81VBeHMUgoZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANFVCCHOVQXZzVQE/81UBf/NVATay1IIIgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADPUAAQzFUF3s1UBP/NVAT/zVUF685VDBUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAzlUAFc5VBOjNVQT/zFQE/81VBeHMUgoZAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAANFVCCHOVQTZzVQE/81UBP/NVATay1IIIgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADPUQAQzFUF3s1UBP/NVAT/zlYF6s5VDBUAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAzlUAFc5VBOjNVQT/zVUE/81VBOHMUgoZAAAAAAAAAAAAAAAAAQAAAAAAAAAAAQAAAQAAANFVCCHOVQTZzVQE/81UBP/NVATay1IIIgAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAADPUQAQzFUF3s1UBP/NVAT/zlYF6s5VDBUAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzlUAFc5VBOjNVAT/zVQE/81VBeHMUgoZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANFVCCHMVQTZzFQD/81UBP/NVATay1IIIgAAAAAAAQAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAP///////wAA////////AAD///////8AAP///////wAA////////AAD///////8AAP///////wAA////////AAD///////8AAP//+B///wAA///4D///AAD///gH//8AAP//+AP//wAA/+AAAAf/AAD/gAAAAf8AAP8AAAAA/wAA/wAAAAD/AAD/AAAAAP8AAP8AAAAA/wAA/wAAEAD/AAD/A/gfwP8AAP8D+B/A/wAA/wP4H8D/AAD/A/gfwP8AAP8D+B/A/wAA/wP4H8D/AAD/A/gfwP8AAP8D+B/A/wAA/wP4H8D/AAD/A/gfwP8AAP8D+B/A/wAA/wP4H8D/AAD/A/APwP8AAP8AAAAA/wAA/wAAAAD/AAD/AAAAAP8AAP8AAAAA/wAA/4AAAAH/AAD/wAGAA/8AAP///////wAA////////AAD///////8AAP///////wAA////////AAD///////8AAP///////wAA////////AAD///////8AACgAAAAgAAAAQAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAAAAAEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAABAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAABAAAAAAABAAAAAAAAAAAAAQAAAAAAAAD/AAAB/4ABAoCAAAL/AAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAAAAAABAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/wAAAcZVAAnQVQU2y1UFNtFcAAuqVQADAAAAAAAAAAAAAAEAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAD/gAACy1YDWc1VA/TNVAT2zVQDk9FdAAv+AQABAQAAAAABAAABAAAAAAAAAAAAAAAAAQAAAQAAAAAAAAAAAAAAAAABAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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";

app.get("/favicon.ico", (c) => {
  const bytes = Uint8Array.from(atob(FAVICON_BASE64), (c) => c.charCodeAt(0));
  return new Response(bytes, {
    headers: {
      "Content-Type": "image/x-icon",
      "Cache-Control": "public, max-age=31536000, immutable",
    },
  });
});

const EXTENSION_CONTENT_TYPES: Record<string, string> = {
  vtt: "text/vtt",
  srt: "text/plain",
  mp4: "video/mp4",
  webm: "video/webm",
  mp3: "audio/mpeg",
  jpg: "image/jpeg",
  jpeg: "image/jpeg",
  png: "image/png",
  webp: "image/webp",
  gif: "image/gif",
  svg: "image/svg+xml",
  pdf: "application/pdf",
};

function getContentType(key: string, s3ContentType: string | null): string {
  const ext = key.split(".").pop()?.toLowerCase();
  if (ext && EXTENSION_CONTENT_TYPES[ext]) {
    return EXTENSION_CONTENT_TYPES[ext];
  }
  return s3ContentType || "application/octet-stream";
}

function addCorsHeaders(headers: Headers): void {
  headers.set("Access-Control-Allow-Origin", "*");
  headers.set("Access-Control-Allow-Methods", "GET, HEAD, OPTIONS");
  headers.set("Access-Control-Allow-Headers", "Range");
  headers.set("Access-Control-Expose-Headers", "Content-Length, Content-Range");
}

app.options("/*", (c) => {
  const headers = new Headers();
  addCorsHeaders(headers);
  return new Response(null, { status: 204, headers });
});

app.get("/*", async (c) => {
  const key = c.req.path.slice(1);

  if (!key) {
    return c.text("Not found", 404);
  }

  const cache = caches.default;
  const cacheKey = new Request(c.req.url.split("?")[0]);

  const cachedResponse = await cache.match(cacheKey);
  if (cachedResponse) {
    const headers = new Headers(cachedResponse.headers);
    addCorsHeaders(headers);
    return new Response(cachedResponse.body, {
      status: cachedResponse.status,
      headers,
    });
  }

  const rangeHeader = c.req.header("range");
  const s3Response = await getS3Object(key, c.env, rangeHeader);

  if (!s3Response.ok && s3Response.status !== 206) {
    return c.text("Not found", 404);
  }

  const headers = new Headers({
    "Content-Type": getContentType(key, s3Response.headers.get("Content-Type")),
    "Cache-Control": "public, max-age=31536000, immutable",
    "Accept-Ranges": "bytes",
  });
  addCorsHeaders(headers);

  const contentLength = s3Response.headers.get("Content-Length");
  if (contentLength) {
    headers.set("Content-Length", contentLength);
  }

  const contentRange = s3Response.headers.get("Content-Range");
  if (contentRange) {
    headers.set("Content-Range", contentRange);
  }

  const response = new Response(s3Response.body, {
    status: s3Response.status,
    headers,
  });

  if (s3Response.status === 200) {
    c.executionCtx.waitUntil(cache.put(cacheKey, response.clone()));
  }

  return response;
});

export default app;
